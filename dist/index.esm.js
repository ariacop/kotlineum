import{useRef as t,useState as e,useEffect as n}from"react";function r(){var t={current:new Map},e={subscribe:function(n,r){return t.current.set(n,r),function(){return e.unsubscribe(n)}},unsubscribe:function(e){t.current.delete(e)},emit:function(e){t.current.forEach((function(t){return t(e)}))},getSubscriberCount:function(){return t.current.size}};return e}function o(){var e=t(new Map),n={subscribe:function(t,r){return e.current.set(t,r),function(){return n.unsubscribe(t)}},unsubscribe:function(t){e.current.delete(t)},emit:function(t){e.current.forEach((function(e){return e(t)}))},getSubscriberCount:function(){return e.current.size}},r=[function(t){return n.emit(t)},function(t){var e="sub-".concat(Math.random());return n.subscribe(e,t)}];return Object.assign(r,n),r}function i(n){var r=e(n),i=r[0],u=r[1],s=o();return t((function(){s.subscribe("internal-state",(function(t){return u(t)}))})).current(),[i,s.emit,function(t){return s.subscribe("sub-".concat(Math.random()),t)}]}function u(t){var e={current:new Map},n=t,r={getValue:function(){return n},subscribe:function(t,o){return e.current.set(t,o),o(n),function(){return r.unsubscribe(t)}},unsubscribe:function(t){e.current.delete(t)},update:function(t){n=t,e.current.forEach((function(e){return e(t)}))},getSubscriberCount:function(){return e.current.size}};return r}function s(n){var r=e(n),o=r[0],i=r[1],u=t(new Map),s={getValue:function(){return o},subscribe:function(t,e){return u.current.set(t,e),e(o),function(){return s.unsubscribe(t)}},unsubscribe:function(t){u.current.delete(t)},update:function(t){i(t),u.current.forEach((function(e){return e(t)}))},getSubscriberCount:function(){return u.current.size}},c=[o,s.update];return Object.assign(c,s),c}var c=function(){function t(){this.flows=new Map}return t.getInstance=function(){return t.instance||(t.instance=new t),t.instance},t.prototype.getOrCreate=function(t){if(!this.flows.has(t)){var e=new Map,n={subscribe:function(t,r){return e.set(t,r),function(){return n.unsubscribe(t)}},unsubscribe:function(t){e.delete(t)},emit:function(t){e.forEach((function(e){return e(t)}))},getSubscriberCount:function(){return e.size}};this.flows.set(t,n)}return this.flows.get(t)},t.prototype.get=function(t){return this.flows.get(t)},t.prototype.has=function(t){return this.flows.has(t)},t}();function a(t){return c.getInstance().getOrCreate(t)}function f(t,e){var r=a(t);n((function(){var n;return e&&(n=r.subscribe("hook-".concat(t,"-").concat(Math.random()),e)),function(){n&&n()}}),[t,e]);return[function(t){return r.emit(t)},function(e){return r.subscribe("sub-".concat(t,"-").concat(Math.random()),e)}]}function l(t,r){var o=e(r),i=o[0],u=o[1],s=a(t);return n((function(){return s.subscribe("state-".concat(t,"-").concat(Math.random()),(function(t){return u(t)}))}),[t]),[i,function(t){return s.emit(t)}]}var p,d=function(){return d=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},d.apply(this,arguments)};function b(t,e,n,r){return new(n||(n=Promise))((function(o,i){function u(t){try{c(r.next(t))}catch(t){i(t)}}function s(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(u,s)}c((r=r.apply(t,e||[])).next())}))}function h(t,e){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},u=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return u.next=s(0),u.throw=s(1),u.return=s(2),"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;u&&(u=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=e.call(t,i)}catch(t){s=[6,t],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}}function g(t,e,n){if(n||2===arguments.length)for(var r,o=0,i=e.length;o<i;o++)!r&&o in e||(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))}"function"==typeof SuppressedError&&SuppressedError,function(t){t.LOCAL_STORAGE="localStorage",t.INDEXED_DB="indexedDB"}(p||(p={}));var v=function(){function t(){}return t.openDatabase=function(t,e){var n=this;return new Promise((function(r,o){if(n.openConnections.has(t))r(n.openConnections.get(t));else if(window.indexedDB){var i=indexedDB.open(t,1);i.onerror=function(t){o(new Error("IndexedDB error: ".concat(t.target.error)))},i.onupgradeneeded=function(t){var n=t.target.result;n.objectStoreNames.contains(e)||n.createObjectStore(e)},i.onsuccess=function(e){var o=e.target.result;n.openConnections.set(t,o),window.addEventListener("beforeunload",(function(){o.close(),n.openConnections.delete(t)}),{once:!0}),r(o)}}else o(new Error("IndexedDB is not supported in this browser"))}))},t.getValue=function(t,e,n){var r=this;return new Promise((function(o,i){return b(r,void 0,void 0,(function(){var r,u,s,c,a;return h(this,(function(f){switch(f.label){case 0:return f.trys.push([0,2,,3]),[4,this.openDatabase(t,e)];case 1:return r=f.sent(),u=r.transaction(e,"readonly"),s=u.objectStore(e),(c=s.get(n)).onsuccess=function(){o(c.result)},c.onerror=function(){i(c.error)},[3,3];case 2:return a=f.sent(),i(a),[3,3];case 3:return[2]}}))}))}))},t.setValue=function(t,e,n,r){var o=this;return new Promise((function(i,u){return b(o,void 0,void 0,(function(){var o,s,c,a,f;return h(this,(function(l){switch(l.label){case 0:return l.trys.push([0,2,,3]),[4,this.openDatabase(t,e)];case 1:return o=l.sent(),s=o.transaction(e,"readwrite"),c=s.objectStore(e),(a=c.put(r,n)).onsuccess=function(){i()},a.onerror=function(){u(a.error)},[3,3];case 2:return f=l.sent(),u(f),[3,3];case 3:return[2]}}))}))}))},t.openConnections=new Map,t}();var w=function(){function t(){this.flows=new Map,this.persistOptions=new Map,this.debouncedSaveFunctions=new Map}return t.getInstance=function(){return t.instance||(t.instance=new t),t.instance},t.prototype.getOrCreate=function(e,n,r){var o,i,u,s=this;if(!this.flows.has(e)){var c=new Map;if(null==r?void 0:r.enabled){var a=r.storageKey||"kotlineum_state_".concat(e),f=r.storageType||p.LOCAL_STORAGE,l=r.dbName||"kotlineum_db",d=r.storeName||"kotlineum_store",b=r.debounceTime||300;this.persistOptions.set(e,{storageKey:a,enabled:!0,storageType:f,dbName:l,storeName:d,debounceTime:b,serialize:r.serialize||JSON.stringify,deserialize:r.deserialize||JSON.parse}),this.debouncedSaveFunctions.set(e,(o=function(t,n){return s.saveToStorage(e,t,n)},i=b,u=null,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];null!==u&&clearTimeout(u),u=setTimeout((function(){u=null,o.apply(void 0,t)}),i)}))}var h=n,g=this.persistOptions.get(e);(null==g?void 0:g.enabled)&&"undefined"!=typeof window&&this.loadFromStorage(e,g).then((function(t){void 0!==t&&s.flows.has(e)&&s.flows.get(e).update(t)})).catch((function(t){console.warn("Failed to load state from storage for key ".concat(e,":"),t)}));var v={getValue:function(){return h},subscribe:function(t,e){return c.set(t,e),e(h),function(){return v.unsubscribe(t)}},unsubscribe:function(t){c.delete(t)},update:function(n){h=n,c.forEach((function(t){return t(n)}));var r=t.getInstance().persistOptions.get(e);if((null==r?void 0:r.enabled)&&"undefined"!=typeof window){var o=t.getInstance().debouncedSaveFunctions.get(e);o&&o(n,r)}},getSubscriberCount:function(){return c.size}};this.flows.set(e,v)}return this.flows.get(e)},t.prototype.get=function(t){return this.flows.get(t)},t.prototype.has=function(t){return this.flows.has(t)},t.prototype.saveToStorage=function(t,e,n){try{if(n.storageType===p.INDEXED_DB){var r=n.serialize(e);v.setValue(n.dbName,n.storeName,n.storageKey,r).catch((function(e){console.warn("Failed to persist state to IndexedDB for key ".concat(t,":"),e)}))}else{r=n.serialize(e);localStorage.setItem(n.storageKey,r)}}catch(e){console.warn("Failed to persist state to storage for key ".concat(t,":"),e)}},t.prototype.loadFromStorage=function(t,e){return b(this,void 0,void 0,(function(){var t,n;return h(this,(function(r){switch(r.label){case 0:return r.trys.push([0,4,,5]),e.storageType!==p.INDEXED_DB?[3,2]:[4,v.getValue(e.dbName,e.storeName,e.storageKey)];case 1:return(t=r.sent())?[2,e.deserialize(t)]:[3,3];case 2:if(n=localStorage.getItem(e.storageKey))return[2,e.deserialize(n)];r.label=3;case 3:return[3,5];case 4:throw r.sent();case 5:return[2,void 0]}}))}))},t}();function y(t,e,n){return w.getInstance().getOrCreate(t,e,n)}function m(t,r,o){var i=e(r),u=i[0],s=i[1],c=y(t,r,o);return n((function(){var e=c.subscribe("hook-".concat(t,"-").concat(Math.random()),(function(t){s(t)}));return s(c.getValue()),e}),[t,r]),[u,function(t){return c.update(t)}]}var S=function(){function t(t){this.isDisposed=!1,this.stateFlow=u({data:t,loading:!1,error:null}),this.eventsFlow=r()}return t.prototype.getState=function(){return this.stateFlow.getValue()},t.prototype.getData=function(){return this.stateFlow.getValue().data},t.prototype.subscribeToState=function(t,e){return this.stateFlow.subscribe(t,e)},t.prototype.subscribeToEvents=function(t,e){return this.eventsFlow.subscribe(t,e)},t.prototype.setLoading=function(t){this.stateFlow.update(d(d({},this.stateFlow.getValue()),{loading:t}))},t.prototype.setError=function(t){this.stateFlow.update(d(d({},this.stateFlow.getValue()),{error:t}))},t.prototype.updateData=function(t){this.stateFlow.update(d(d({},this.stateFlow.getValue()),{data:t}))},t.prototype.updateState=function(t){this.stateFlow.update(d(d({},this.stateFlow.getValue()),t))},t.prototype.emitEvent=function(t){this.eventsFlow.emit(t)},t.prototype.dispose=function(){this.isDisposed||(this.onDispose(),this.isDisposed=!0)},t.prototype.onDispose=function(){},t}(),M=function(){function t(){this.viewModels=new Map}return t.getInstance=function(){return t.instance||(t.instance=new t),t.instance},t.prototype.get=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!this.viewModels.has(t)){var o=new(e.bind.apply(e,g([void 0],n,!1)));return this.viewModels.set(t,o),o}return this.viewModels.get(t)},t.prototype.has=function(t){return this.viewModels.has(t)},t.prototype.remove=function(t){if(this.viewModels.has(t)){var e=this.viewModels.get(t);null==e||e.dispose(),this.viewModels.delete(t)}},t.prototype.clear=function(){this.viewModels.forEach((function(t){return t.dispose()})),this.viewModels.clear()},t}();function D(r,o){for(var i=[],u=2;u<arguments.length;u++)i[u-2]=arguments[u];var s=M.getInstance(),c=s.get.apply(s,g([r,o],i,!1)),a=e(c.getState()),f=a[0],l=a[1],p=t("vm-".concat(r,"-").concat(Math.random()));return n((function(){var t=c.subscribeToState(p.current,l);return function(){t()}}),[c]),[f,c]}function E(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o="global-".concat(t);return D.apply(void 0,g([o,e],n,!1))}export{a as GlobalSharedFlow,y as GlobalStateFlow,r as SharedFlow,u as StateFlow,p as StorageType,S as ViewModel,M as ViewModelProvider,f as useGlobalSharedFlow,l as useGlobalSharedFlowWithState,m as useGlobalStateFlow,E as useGlobalViewModel,o as useSharedFlow,i as useSharedFlowWithState,s as useStateFlow,D as useViewModel};
//# sourceMappingURL=index.esm.js.map
